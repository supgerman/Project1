<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--J Query-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!--Firebase-->
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>

</head>

<!--HTML BEGINS HERE-->

<body>

    <form>
        <div class="form-group">
            <label for="searchZipCode">Zip Code</label>
            <input type="text" class="form-control" id="searchZipCode">
        </div>
        <button type="submit" class="btn btn-primary" id="searchZipCodeButton">Submit</button>
    </form>

    <div id="mapid"></div>

    <br><br>

    <div>Map Goes Here</div>

    <br><br>

    <div>Click submit button to render data from Firebase.</div>


    <br><br>

    <div>Firebase rendered information goes here...</div>


    <!--JS BEGINS HERE-->
    <script>

        //INITIALIZE FIREBASE: Firebase database was created and the following the configuration was
        //copied/pasted from the Users Authentication tab for the respective database.
        //Vendor entered information will be saved here for display later on on user page.
        var config = {
            apiKey: "AIzaSyAtDIitolx33OIPaqziRfVfvWYWS0MY5Ik",
            authDomain: "group-project-1-2127f.firebaseapp.com",
            databaseURL: "https://group-project-1-2127f.firebaseio.com",
            projectId: "group-project-1-2127f",
            storageBucket: "group-project-1-2127f.appspot.com",
            messagingSenderId: "525088904938"
        };
        firebase.initializeApp(config);

        // Create a variable to reference the database.
        var database = firebase.database();

        //SCRIPT TAG FOR HTML: Must include in the html file that will use Firebase data.
        //<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js">


        //INTITIAL VALUES
        var vendorChild = "";
        var venueName = "";
        var vendorAddress = "";
        var vendorZip = "";
        var vendorCapacity = "";
        var vendorDetail = "";
        var vendorEmail = "";


        //ON CLICK EVENT: Once submit button is clicked the zip code information entered will
        //be saved and data will be called/ displayed from Firebase.
        $("#searchZipCodeButton").on("click", function (event) {
            event.preventDefault();

            //User entered zipcode is saved in the following variable and console.logged
            var firebaseZipCode = $("#searchZipCode").val().trim();
            console.log("Zip Code Entered: " + firebaseZipCode);

            //FUNCTION TO ACCESS FIREBASE: This function will use the snapshot method to first check
            //Firebase for a zip code that matches then set the variable values listed above.
            // database.ref().orderByChild("details").equalTo(firebaseZipCode).on("value", function (snapshot) {

            var query = firebase.database().ref().orderByKey();
            query.once("value")
                .then(function (snapshot) {
                    snapshot.forEach(function (childSnapshot) {
                        var key = childSnapshot.key;
                        console.log(key);

                        //VENDOR VARIABLES
                        var vendorDataBase = snapshot.val();
                        var vendorChild = snapshot.child(key);
                        var venueName = vendorChild.val().name;
                        var vendorAddress = vendorChild.val().location;
                        var vendorZip = vendorChild.val().details;
                        var vendorCapacity = vendorChild.val().number;
                        var vendorDetail = vendorChild.val().description;
                        var vendorEmail = vendorChild.val().email;

                        //RETURNED VENDOR INFORMATION IF ZIP CODE MATCHES
                        if (vendorZip === firebaseZipCode) {
                            console.log(vendorDataBase);
                            console.log(vendorChild);
                            console.log("Venue Name: " + venueName);
                            console.log("Street Address: " + vendorAddress);
                            console.log("Zip Code: " + vendorZip);
                            console.log("Max Capacity: " + vendorCapacity);
                            console.log("Description: " + vendorDetail);
                            console.log("Contact Email: " + vendorEmail);
                        }

                        //RETURNED IF NO ZIP CODE MATCH: This alert is currently not working ****************
                        else {
                            alert("No vendors found within the zipcode " + firebaseZipCode + ".")
                        }
                    });
                });

        });


    </script>

</body>

</html>